<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <title>Ruleta de Preguntas - Estilo Moderno v4 (Aleatoria)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* Variables CSS y estilos (SIN CAMBIOS RESPECTO A v3) */
    :root {
      /* ... (variables de color y tamaño sin cambios) ... */
      --system-blue: #007aff;
      --system-green: #34c759;
      --system-red: #353535;
      --system-gray-light: #f2f2f7;
      --system-gray-medium: #e5e5ea;
      --system-gray-dark: #00000000;
      --system-gray-border: rgba(30, 30, 30, 0.125);
      --text-primary: #1d1d1f;
      --text-secondary: #000000;
      --background-ultra-thin-material: rgba(255, 0, 0, 0);
      --background-banner-material: rgba(193, 193, 193, 0.138);
      --background-center-circle: rgb(255, 255, 255);
      --border-radius-medium: 10px;
      --border-radius-large: 16px;
      --blur-amount: 20px;
      --shadow-color-light: rgba(0, 0, 0, 0.224);
      --shadow-color-medium: rgba(0, 0, 0, 0.12);
      --wheel-size: 460px;
      --center-circle-size: 130px;
      --pointer-arrow-height: 25px;
      --pointer-arrow-base: 18px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html,
    body {
      /* ... */
      width: 100%;
      height: 100%;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
      background-color: var(--system-gray-light);
      color: var(--text-primary);
      overflow: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
    }

    .icon-button {
      /* ... */
      position: fixed;
      background-color: rgba(0, 0, 0, 0.05);
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      z-index: 1001;
      transition: background-color 0.2s ease, transform 0.2s ease;
      color: var(--text-secondary);
    }

    .icon-button:hover {
      /* ... */
      background-color: rgba(0, 0, 0, 0.1);
      transform: scale(1.1);
    }

    .icon-button svg {
      /* ... */
      width: 20px;
      height: 20px;
      fill: currentColor;
    }

    #fullscreenButton {
      /* ... */
      top: 20px;
      right: 20px;
    }

    .container {
      /* ... */
      width: 100%;
      height: 100%;
      padding-top: 30px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      position: relative;
    }

    h1 {
      /* ... */
      font-size: 2.3em;
      font-weight: 600;
      margin-bottom: 15px;
      color: var(--text-primary);
    }

    .static-pointer {
      /* ... */
      position: absolute;
      top: calc(55% - var(--wheel-size) / 2 - var(--pointer-arrow-height) - 9px);
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: var(--pointer-arrow-base) solid transparent;
      border-right: var(--pointer-arrow-base) solid transparent;
      border-top: var(--pointer-arrow-height) solid var(--system-gray-dark);
      z-index: 5;
    }

    .wheel-container {
      /* ... */
      position: relative;
      width: var(--wheel-size);
      height: var(--wheel-size);
      margin-top: calc(var(--pointer-arrow-height) + 15px);
      margin-bottom: 35px;
      border-radius: 50%;
      background-color: var(--background-ultra-thin-material);
      backdrop-filter: blur(var(--blur-amount));
      -webkit-backdrop-filter: blur(var(--blur-amount));
      box-shadow: 0 8px 25px var(--shadow-color-light);
      border: 1px solid var(--system-gray-border);
      overflow: hidden;
    }

    #centerCircle {
      /* ... */
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: var(--center-circle-size);
      height: var(--center-circle-size);
      background-color: var(--background-center-circle);
      border-radius: 50%;
      border: 1px solid var(--system-gray-border);
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.12);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 6;
      transition: opacity 0.3s ease-in-out;
      opacity: 1;
    }

    #selectedNumber {
      /* ... */
      font-size: 3.8em;
      font-weight: bold;
      color: var(--system-red);
      opacity: 0;
      transition: opacity 0.3s ease-in-out 0.1s;
    }

    #selectedNumber.visible {
      /* ... */
      opacity: 1;
    }

    #wheel {
      /* ... */
      width: 100%;
      height: 100%;
      transition: transform 4s cubic-bezier(0.33, 1, 0.68, 1);
    }

    .action-button {
      /* ... */
      padding: 12px 28px;
      font-size: 1.05em;
      font-weight: 500;
      border: none;
      border-radius: var(--border-radius-medium);
      cursor: pointer;
      transition: background-color 0.2s ease, box-shadow 0.2s ease, transform 0.1s ease;
      letter-spacing: 0.3px;
    }

    .action-button:hover {
      /* ... */
      transform: scale(1.03);
      box-shadow: 0 4px 12px var(--shadow-color-light);
    }

    .action-button:active {
      /* ... */
      transform: scale(0.98);
      box-shadow: 0 2px 5px var(--shadow-color-medium);
    }

    #spinButton {
      /* ... */
      background-color: var(--system-blue);
      color: white;
    }

    #spinButton:hover {
      /* ... */
      background-color: #006ae6;
    }

    #banner {
      /* ... */
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.95);
      min-width: 320px;
      max-width: 550px;
      width: 90%;
      background-color: var(--background-banner-material);
      backdrop-filter: blur(var(--blur-amount));
      -webkit-backdrop-filter: blur(var(--blur-amount));
      padding: 40px 35px 35px 35px;
      border-radius: var(--border-radius-large);
      box-shadow: 0 12px 40px var(--shadow-color-medium);
      border: 1px solid var(--system-gray-border);
      text-align: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    #banner.visible {
      /* ... */
      opacity: 1;
      visibility: visible;
      transform: translate(-50%, -50%) scale(1);
    }

    #closeBanner {
      /* ... */
      position: absolute;
      top: 12px;
      right: 12px;
      background-color: rgba(0, 0, 0, 0.08);
      width: 30px;
      height: 30px;
    }

    #closeBanner:hover {
      /* ... */
      background-color: rgba(0, 0, 0, 0.15);
    }

    #closeBanner svg {
      /* ... */
      width: 14px;
      height: 14px;
      fill: var(--text-secondary);
    }

    #banner p#bannerPregunta {
      /* ... */
      margin-bottom: 30px;
      font-size: 1.9em;
      line-height: 1.5;
      color: var(--text-primary);
      font-weight: 500;
    }

    #bannerAnswerButton {
      /* ... */
      background-color: var(--system-green);
      color: white;
      font-size: 1.1em;
      padding: 13px 30px;
    }

    #bannerAnswerButton:hover {
      /* ... */
      background-color: #2dbd50;
    }

    #banner .respuesta {
      /* ... */
      margin-top: 25px;
      font-size: 1.8em;
      color: var(--system-green);
      font-weight: 500;
      min-height: 1.6em;
    }
  </style>
</head>

<body>
  <button id="fullscreenButton" class="icon-button" title="Pantalla Completa"> <svg xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24">
      <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z" />
    </svg> </button>
  <div class="container">
    <div class="static-pointer"></div>
    <h1>Escudriñando Las Escrituras</h1>
    <div class="wheel-container">
      <div id="centerCircle"> <span id="selectedNumber"></span> </div>
      <svg id="wheel" viewBox="0 0 300 300"></svg>
    </div>
    <button id="spinButton" class="action-button">Girar Ruleta</button>
  </div>
  <div id="banner"> <button id="closeBanner" class="icon-button" title="Cerrar"> <svg viewBox="0 0 24 24">
        <path
          d="M18.3 5.71a.996.996 0 0 0-1.41 0L12 10.59 7.11 5.7a.996.996 0 1 0-1.41 1.41L10.59 12l-4.89 4.89a.996.996 0 1 0 1.41 1.41L12 13.41l4.89 4.89a.996.996 0 1 0 1.41-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4z" />
      </svg> </button>
    <p id="bannerPregunta"></p> <button id="bannerAnswerButton" class="action-button">Mostrar Respuesta</button>
    <div class="respuesta" id="bannerRespuesta"></div>
  </div>

  <script>
    const segments = [
      { number: "1", pregunta: "1. ¿Cuántas generaciones hubo desde Abraham hasta Cristo?", respuesta: "42. Mateo 1:17", used: false },
      { number: "2", pregunta: "2. ¿Por qué le dijo el ángel del señor a José que se fueran de Egipto a tierra de Israel?", respuesta: "Porque habían muerto los que procuraban la muerte del niño.Mateo 2:19 y 20", used: false },
      { number: "3", pregunta: "3. ¿A quiénes les dijeron generaciones de víboras?", respuesta: "A los fariseos y a los saduceos. Mateo 3:7", used: false },
      { number: "4", pregunta: "4. ¿Que debemos hacer para ser hijos de nuestro padre celestial? ", respuesta: "Amar a nuestros enegmigos, bendecir a los que nos maldicen, hacer el bien a los que nos aborrecen, y orar por los que nos ultrajan y nos persiguen. Mateo 5:44", used: false },
      { number: "5", pregunta: "5. ¿Cuáles fueron las primeras palabras de Jesús cuando empezó a predicar?", respuesta: "Arrepentíos, porque el reino de los cielos se ha acercado. Mateo 4:17", used: false },
      { number: "6", pregunta: "6. ¿Qué cosas o serán añadidas al buscar el reino de los cielos?", respuesta: "Comida, bebida y vestido.Mateo 6:31;33", used: false },
      { number: "7", pregunta: "7. ¿Por qué se admiraba la gente de la doctrina que Jesús enseñaba?", respuesta: "Porque les enseñaba con autoridad, no como los escribas. Mateo 7:28-29", used: false },

    ];

    let currentRotation = 0;
    let spinning = false;
    let preguntaSeleccionada = null;

    const wheelEl = document.getElementById("wheel");
    const spinButton = document.getElementById("spinButton");
    const fullscreenButton = document.getElementById("fullscreenButton");
    const banner = document.getElementById("banner");
    const bannerPregunta = document.getElementById("bannerPregunta");
    const bannerRespuesta = document.getElementById("bannerRespuesta");
    const bannerAnswerButton = document.getElementById("bannerAnswerButton");
    const closeBanner = document.getElementById("closeBanner");
    const selectedNumberEl = document.getElementById("selectedNumber");


    function getAvailableSegments() {
      return segments.filter(seg => !seg.used)
        .sort((a, b) => parseInt(a.number) - parseInt(b.number));
    }

    // Función getSegmentIndexUnderPointer YA NO ES NECESARIA para elegir

    function drawWheel() {
      // ... (Función drawWheel SIN CAMBIOS respecto a v3) ...
      const avail = getAvailableSegments(); const n = avail.length; const svgNS = "http://www.w3.org/2000/svg";
      while (wheelEl.firstChild) { wheelEl.removeChild(wheelEl.firstChild); }
      const cx = 150, cy = 150, r = 150; const anglePerSegment = n > 0 ? 360 / n : 360;
      const fillColor1 = getComputedStyle(document.documentElement).getPropertyValue('--system-gray-light').trim() || '#f2f2f7';
      const fillColor2 = getComputedStyle(document.documentElement).getPropertyValue('--system-gray-medium').trim() || '#e5e5ea';
      const textColor = getComputedStyle(document.documentElement).getPropertyValue('--text-primary').trim() || '#1d1d1f';
      const strokeColor = getComputedStyle(document.documentElement).getPropertyValue('--system-gray-border').trim() || 'rgba(60, 60, 67, 0.29)';
      for (let i = 0; i < n; i++) {
        const startAngle = anglePerSegment * i - 90; const endAngle = anglePerSegment * (i + 1) - 90;
        const startX = cx + r * Math.cos(startAngle * Math.PI / 180); const startY = cy + r * Math.sin(startAngle * Math.PI / 180);
        const endX = cx + r * Math.cos(endAngle * Math.PI / 180); const endY = cy + r * Math.sin(endAngle * Math.PI / 180);
        const largeArcFlag = anglePerSegment > 180 ? 1 : 0;
        const pathData = `M ${cx},${cy} L ${startX},${startY} A ${r},${r} 0 ${largeArcFlag} 1 ${endX},${endY} Z`;
        const path = document.createElementNS(svgNS, "path"); const fill = (i % 2 === 0) ? fillColor1 : fillColor2;
        path.setAttribute("d", pathData); path.setAttribute("fill", fill); path.setAttribute("stroke", strokeColor);
        path.setAttribute("stroke-width", "0.5"); path.setAttribute("id", "seg-" + avail[i].number); wheelEl.appendChild(path);
        const textAngle = startAngle + anglePerSegment / 2; const textRadius = r * 0.78;
        const textX = cx + textRadius * Math.cos(textAngle * Math.PI / 180); const textY = cy + textRadius * Math.sin(textAngle * Math.PI / 180);
        const text = document.createElementNS(svgNS, "text"); text.setAttribute("x", textX); text.setAttribute("y", textY);
        text.setAttribute("font-size", "22"); text.setAttribute("font-weight", "500"); text.setAttribute("fill", textColor);
        text.setAttribute("text-anchor", "middle"); text.setAttribute("dominant-baseline", "middle");
        text.textContent = avail[i].number; wheelEl.appendChild(text);
      }
    }

    drawWheel();

    function spinWheel() {
      if (spinning) return;
      const avail = getAvailableSegments();
      if (avail.length === 0) {
        alert("¡Felicidades! Has respondido todas las preguntas.");
        return;
      }

      spinning = true;
      spinButton.disabled = true;
      banner.classList.remove('visible');
      bannerRespuesta.textContent = "";
      selectedNumberEl.classList.remove('visible');

      const n = avail.length;
      const anglePerSegment = 360 / n;

      // --- INICIO: Lógica Aleatoria ---
      // 1. Elegir un índice aleatorio entre los segmentos disponibles
      const chosenIndex = Math.floor(Math.random() * n);
      const chosenSegment = avail[chosenIndex];
      // --- FIN: Lógica Aleatoria ---


      // 2. Calcular la rotación necesaria para que el centro de ESTE segmento (chosenSegment)
      //    termine exactamente bajo el puntero después de la animación.
      const currentVisualRotation = currentRotation % 360;
      const centerAngleSVG = anglePerSegment * chosenIndex + anglePerSegment / 2 - 90;
      const targetAngle = (360 - centerAngleSVG + 360) % 360; // Asegura positivo
      const rotationNeeded = (targetAngle - currentVisualRotation + 360) % 360; // Rotación neta necesaria

      // Añadir vueltas completas + un poco de aleatoriedad extra para que no siempre gire igual
      const randomExtraRotation = Math.random() * 360; // Giro extra aleatorio (hasta 1 vuelta)
      const totalRotation = (5 * 360) + rotationNeeded + randomExtraRotation; // 5 vueltas + ajuste + extra aleatorio

      currentRotation += totalRotation; // Acumular rotación total

      wheelEl.style.transform = `rotate(${currentRotation}deg)`;

      // 3. Timeout para mostrar resultados después de la animación
      setTimeout(() => {
        // Marcar el segmento elegido aleatoriamente como usado
        const originalIndex = segments.findIndex(seg => seg.number === chosenSegment.number);
        if (originalIndex !== -1) {
          segments[originalIndex].used = true;
        } else { console.error("Error: Índice original no encontrado."); }

        // Mostrar número en el círculo central
        selectedNumberEl.textContent = chosenSegment.number;
        selectedNumberEl.classList.add('visible');

        // Preparar y mostrar banner
        preguntaSeleccionada = chosenSegment;
        bannerPregunta.textContent = chosenSegment.pregunta;
        banner.classList.add('visible');

        spinning = false;
        spinButton.disabled = false;

        // Redibujar ruleta sin el segmento usado (después de un delay)
        setTimeout(() => {
          drawWheel();
          // Mantener la posición visual final sin animación
          wheelEl.style.transition = 'none';
          // Calculamos la rotación final exacta para alinear
          const finalTargetAngle = (360 - centerAngleSVG + 360) % 360;
          wheelEl.style.transform = `rotate(${finalTargetAngle}deg)`;
          void wheelEl.offsetWidth; // Force reflow
          wheelEl.style.transition = 'transform 4s cubic-bezier(0.33, 1, 0.68, 1)';
          // Actualizar currentRotation a la posición visual final
          currentRotation = finalTargetAngle;
        }, 800);

      }, 4000); // Duración de la animación CSS (4 segundos)
    }

    function mostrarRespuesta() {
      if (preguntaSeleccionada) { bannerRespuesta.textContent = preguntaSeleccionada.respuesta; }
    }

    function activarPantallaCompleta() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().catch(err => {
          console.error(`Error pantalla completa: ${err.message} (${err.name})`);
        });
      } else { if (document.exitFullscreen) { document.exitFullscreen(); } }
    }

    closeBanner.addEventListener("click", () => { banner.classList.remove('visible'); });
    spinButton.addEventListener("click", spinWheel);
    bannerAnswerButton.addEventListener("click", mostrarRespuesta);
    fullscreenButton.addEventListener("click", activarPantallaCompleta);

  </script>
</body>

</html>
